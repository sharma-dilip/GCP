steps:
#  - name: 'gcr.io/cloud-builders/npm'  
#    args: ['install']
  - name: 'gcr.io/cloud-builders/npm:latest'
    args: ['--version']
  - name: 'gcr.io/cloud-builders/npm:latest'  
    args: ['test']
  - name: 'gcr.io/cloud-builders/docker'  
    args: ["build", "-t", "gcr.io/$PROJECT_ID/my-image:$REVISION_ID", "."]
  - name: 'gcr.io/cloud-builders/docker'  
    args: ["push", "gcr.io/$PROJECT_ID/my-image:$REVISION_ID"]
  - name: 'gcr.io/cloud-builders/kubectl' 
    args: 
      - 'set' 
      - 'image' 
      - 'deployment/my-nodejs-deployment' 
      - 'my-container=gcr.io/$PROJECT_ID/my-image:$REVISION_ID'
    env: 
      - 'CLOUDSDK_COMPUTE_ZONE=europe-west2-a' 
      - 'CLOUDSDK_CONTAINER_CLUSTER=gke-demo-cluster'
  - name: 'gcr.io/cloud-builders/kubectl' 
    args: 
      - 'expose' 
      - 'deployment' 
      - 'my-nodejs-deployment' 
      - '--port=80'
      - '--target-port=6060'
    env: 
      - 'CLOUDSDK_COMPUTE_ZONE=europe-west2-a' 
      - 'CLOUDSDK_CONTAINER_CLUSTER=gke-demo-cluster'
